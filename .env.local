# Local Development Environment Configuration
# =============================================
# Use this file when running 3 nodes on a single machine for local testing.
# Copy to .env or source before running: export $(cat .env.local | xargs)
#
# Target environment (for reference):
#   - 3 separate nodes
#   - CPU: Intel Xeon Gold 6242 @ 2.80GHz (~16 cores)
#   - 16 GB RAM per node
#   - GPU: NVIDIA Tesla T4, 15 GB VRAM (optional)
#
# Local machine assumptions:
#   - Single machine with 14 cores, 24GB RAM
#   - All 3 nodes running on same machine
#   - Must share CPU cores and memory

# === Enable Local Development Mode ===
# This automatically partitions CPU cores among nodes
LOCAL_DEV_MODE=true

# === CPU Thread Configuration ===
# With 14 cores and 3 nodes, we allocate ~4 cores per node
# (14 - 2 system overhead) / 3 = 4 cores per node
CPU_INFERENCE_THREADS=4
FAISS_THREADS=4
CPU_WORKER_THREADS=4

# === Memory-Saving Options ===
# Enable FAISS mmap to reduce memory usage (slower but uses less RAM)
# Each node has ~8GB effective RAM (24GB / 3)
FAISS_USE_MMAP=false

# === Batching Configuration ===
# Smaller batch sizes to fit in reduced memory per node
GATEWAY_BATCH_SIZE=4
RETRIEVAL_BATCH_SIZE=4
GENERATION_BATCH_SIZE=2

# === Cache Configuration ===
# Reduce cache sizes to save memory in local mode
GATEWAY_CACHE_CAPACITY=500
RETRIEVAL_CACHE_CAPACITY=500
DOCUMENT_CACHE_CAPACITY=2000

# === Payload Mode ===
# Use ID-only mode to reduce inter-node data transfer
DOCUMENTS_PAYLOAD_MODE=id_only

# === Compression ===
# LZ4 for fast compression with low CPU overhead
PIPELINE_RPC_COMPRESSION=lz4
