---
run_id: concurrency_stress
description: >
  Stress test the selected topology under higher concurrency (multiple client
  workers) to observe queueing behavior, gateway batching effectiveness, and
  tail-latency changes.

nodes:
  - number: 0
    profile: configs/baseline_gateway.yaml
    env:
      GATEWAY_BATCH_SIZE: 6
      GATEWAY_BATCH_TIMEOUT_MS: 120
      ENABLE_ADAPTIVE_BATCHING: true
  - number: 1
    profile: configs/retriever_with_rerank.yaml
    env:
      RETRIEVAL_BATCH_SIZE: 10
  - number: 2
    profile: configs/generation_no_rerank.yaml
    env:
      GENERATION_BATCH_SIZE: 4

workload:
  requests: 300
  concurrency: 4  # number of concurrent client workers
  rate_limit: 0.0  # let workers send as fast as possible
  timeout: 300

notes: |-
  Use this run to capture p95/p99 latency under load and to ensure the system
  remains stable. Include per-node CPU/RSS measurements and check for batching
  backlog at the gateway.
